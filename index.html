<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>EXODUS 2157 - AR Experience</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />

  <script src="https://aframe.io/releases/1.6.0/aframe.min.js"></script>
  <script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js/aframe/build/aframe-ar-nft.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Rajdhani:wght@300;500;700&display=swap" rel="stylesheet">

  <style>
    :root {
      --neon-cyan: #00f5ff;
      --neon-magenta: #ff00ff;
      --neon-purple: #b026ff;
      --neon-green: #00ff88;
      --neon-orange: #ff6600;
      --dark-bg: #0a0a12;
    }

    * { box-sizing: border-box; }
    body {
      margin: 0;
      overflow: hidden;
      font-family: 'Rajdhani', sans-serif;
      background: var(--dark-bg);
    }

    .loader {
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: var(--dark-bg);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 9999;
      transition: opacity 0.5s, visibility 0.5s;
    }
    .loader.hidden { opacity: 0; visibility: hidden; }
    .loader-title {
      font-family: 'Orbitron', sans-serif;
      font-size: 24px;
      font-weight: 900;
      color: var(--neon-cyan);
      text-shadow: 0 0 20px var(--neon-cyan);
      letter-spacing: 6px;
    }
    .loader-bar {
      width: 150px;
      height: 2px;
      background: #222;
      margin-top: 20px;
      position: relative;
      overflow: hidden;
    }
    .loader-bar::after {
      content: '';
      position: absolute;
      left: -50%;
      width: 50%;
      height: 100%;
      background: linear-gradient(90deg, transparent, var(--neon-cyan), transparent);
      animation: loadingBar 1.5s infinite;
    }
    @keyframes loadingBar { 0% { left: -50%; } 100% { left: 100%; } }

    .top-bar {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      background: linear-gradient(180deg, rgba(0,0,0,0.9) 0%, rgba(0,0,0,0.7) 70%, transparent 100%);
      padding: 12px 15px 20px 15px;
      z-index: 100;
      pointer-events: none;
    }

    .top-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
    }

    .logo {
      font-family: 'Orbitron', sans-serif;
      font-weight: 900;
      font-size: 16px;
      color: var(--neon-cyan);
      text-shadow: 0 0 10px var(--neon-cyan);
      letter-spacing: 3px;
    }
    .logo span { color: var(--neon-magenta); text-shadow: 0 0 10px var(--neon-magenta); }

    .status {
      font-size: 9px;
      color: #555;
      letter-spacing: 1px;
      text-align: right;
    }
    .status .online { color: var(--neon-green); }

    .progress-row {
      display: flex;
      gap: 8px;
      align-items: center;
    }
    .chapter-dot {
      flex: 1;
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 8px 10px;
      background: rgba(0,0,0,0.5);
      border: 1px solid #222;
      border-radius: 6px;
      transition: all 0.3s;
    }
    .chapter-dot.active {
      border-color: var(--neon-cyan);
      box-shadow: 0 0 10px rgba(0,245,255,0.3);
    }
    .chapter-dot.current {
      border-color: var(--neon-orange);
      animation: pulse 1.5s infinite;
    }
    @keyframes pulse { 0%, 100% { box-shadow: 0 0 5px var(--neon-orange); } 50% { box-shadow: 0 0 12px var(--neon-orange); } }
    .dot-icon { font-size: 16px; }
    .dot-text {
      font-size: 9px;
      color: #555;
      letter-spacing: 1px;
      text-transform: uppercase;
    }
    .chapter-dot.active .dot-text, .chapter-dot.current .dot-text { color: #aaa; }

    .bottom-bar {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      height: 35px;
      background: linear-gradient(0deg, rgba(0,0,0,0.8) 0%, transparent 100%);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 100;
      pointer-events: none;
    }
    .scan-hint {
      font-size: 10px;
      color: #666;
      letter-spacing: 2px;
    }
    .scan-hint .target {
      color: var(--neon-orange);
      font-weight: 700;
    }

    .corner {
      position: fixed;
      width: 20px;
      height: 20px;
      border: 1px solid rgba(0,245,255,0.4);
      z-index: 50;
    }
    .corner-tl { top: 8px; left: 8px; border-right: none; border-bottom: none; }
    .corner-tr { top: 8px; right: 8px; border-left: none; border-bottom: none; }
    .corner-bl { bottom: 8px; left: 8px; border-right: none; border-top: none; }
    .corner-br { bottom: 8px; right: 8px; border-left: none; border-top: none; }

    .chapter-panel {
      position: fixed;
      bottom: 50px;
      left: 12px;
      right: 12px;
      background: linear-gradient(135deg, rgba(0,0,0,0.92) 0%, rgba(20,0,40,0.92) 100%);
      border: 1px solid var(--neon-purple);
      border-radius: 8px;
      padding: 14px 16px;
      z-index: 150;
      opacity: 0;
      transform: translateY(10px);
      transition: all 0.3s;
      pointer-events: none;
    }
    .chapter-panel.show { opacity: 1; transform: translateY(0); }
    .chapter-panel-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 8px;
    }
    .chapter-panel-title {
      font-family: 'Orbitron', sans-serif;
      font-size: 12px;
      color: var(--neon-purple);
      text-shadow: 0 0 8px var(--neon-purple);
      letter-spacing: 2px;
    }
    .chapter-panel-status {
      font-size: 9px;
      color: var(--neon-green);
      letter-spacing: 1px;
    }
    .chapter-panel-story {
      font-size: 13px;
      color: #bbb;
      line-height: 1.5;
    }
    .chapter-panel-story .neon {
      color: var(--neon-cyan);
      font-weight: 600;
    }

    .victory {
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: radial-gradient(ellipse at center, rgba(0,20,40,0.95) 0%, rgba(0,0,0,0.98) 100%);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 300;
      opacity: 0;
      visibility: hidden;
      transition: all 0.5s;
    }
    .victory.show { opacity: 1; visibility: visible; }
    .victory-badge {
      width: 70px;
      height: 70px;
      border: 2px solid var(--neon-green);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 35px;
      margin-bottom: 15px;
      box-shadow: 0 0 25px var(--neon-green);
    }
    .victory-title {
      font-family: 'Orbitron', sans-serif;
      font-size: 18px;
      font-weight: 900;
      color: var(--neon-green);
      text-shadow: 0 0 15px var(--neon-green);
      letter-spacing: 4px;
      margin-bottom: 8px;
    }
    .victory-subtitle {
      font-size: 11px;
      color: #666;
      letter-spacing: 2px;
      margin-bottom: 20px;
    }
    .victory-story {
      max-width: 280px;
      text-align: center;
      margin-bottom: 25px;
    }
    .victory-story p {
      font-size: 12px;
      color: #888;
      line-height: 1.5;
      margin: 8px 0;
    }
    .victory-story .em { color: var(--neon-cyan); font-weight: 600; }
    .victory-btn {
      font-family: 'Orbitron', sans-serif;
      padding: 12px 30px;
      font-size: 10px;
      letter-spacing: 2px;
      background: transparent;
      color: var(--neon-cyan);
      border: 1px solid var(--neon-cyan);
      cursor: pointer;
      transition: all 0.3s;
      pointer-events: auto;
    }
    .victory-btn:active {
      background: var(--neon-cyan);
      color: #000;
    }
  </style>

  <script>
    AFRAME.registerComponent('super-smooth', {
      schema: {
        position: {type: 'vec3'},
        rotation: {type: 'vec3'}
      },
      init: function() {
        this.smoothPos = new THREE.Vector3();
        this.smoothRot = new THREE.Euler();
        this.initialized = false;
      },
      tick: function() {
        const obj = this.el.object3D;
        if (!this.initialized) {
          this.smoothPos.copy(obj.position);
          this.smoothRot.copy(obj.rotation);
          this.initialized = true;
          return;
        }
        const factor = 0.1;
        this.smoothPos.lerp(obj.position, factor);
        this.smoothRot.x += (obj.rotation.x - this.smoothRot.x) * factor;
        this.smoothRot.y += (obj.rotation.y - this.smoothRot.y) * factor;
        this.smoothRot.z += (obj.rotation.z - this.smoothRot.z) * factor;
        obj.position.copy(this.smoothPos);
        obj.rotation.copy(this.smoothRot);
      }
    });
  </script>
</head>
<body>
  <div class="corner corner-tl"></div>
  <div class="corner corner-tr"></div>
  <div class="corner corner-bl"></div>
  <div class="corner corner-br"></div>

  <div class="loader" id="loader">
    <div class="loader-title">EXODUS 2157</div>
    <div class="loader-bar"></div>
  </div>

  <div class="top-bar">
    <div class="top-row">
      <div class="logo">EXODUS<span>2157</span></div>
      <div class="status">SYSTEM <span class="online">ONLINE</span><br>AR TRACKING</div>
    </div>
    <div class="progress-row">
      <div class="chapter-dot current" id="dot1">
        <span class="dot-icon">üåç</span>
        <span class="dot-text">Earth</span>
      </div>
      <div class="chapter-dot" id="dot2">
        <span class="dot-icon">üöÄ</span>
        <span class="dot-text">Exodus</span>
      </div>
      <div class="chapter-dot" id="dot3">
        <span class="dot-icon">üåô</span>
        <span class="dot-text">Moon</span>
      </div>
    </div>
  </div>

  <div class="bottom-bar">
    <div class="scan-hint">SCAN <span class="target" id="scan-target">EARTH</span></div>
  </div>

  <div class="chapter-panel" id="chapter-panel">
    <div class="chapter-panel-header">
      <div class="chapter-panel-title" id="panel-title">CHAPTER I: THE BLIGHT</div>
      <div class="chapter-panel-status">UNLOCKED</div>
    </div>
    <div class="chapter-panel-story" id="panel-story">Story content...</div>
  </div>

  <div class="victory" id="victory">
    <div class="victory-badge">üõ°Ô∏è</div>
    <div class="victory-title">COMPLETE</div>
    <div class="victory-subtitle">HUMANITY PRESERVED</div>
    <div class="victory-story">
      <p>The <span class="em">Exodus Initiative</span> succeeded.</p>
      <p>12,000 survivors call <span class="em">Luna Colony</span> home.</p>
    </div>
    <button class="victory-btn" onclick="resetStory()">RESTART</button>
  </div>

  <a-scene
    embedded
    renderer="colorManagement: true; physicallyCorrectLights: true; logarithmicDepthBuffer: true"
    vr-mode-ui="enabled: false"
    arjs="sourceType: webcam; trackingMethod: best; debugUIEnabled: false;"
    id="scene">

    <a-entity light="type: ambient; intensity: 0.7"></a-entity>
    <a-entity light="type: directional; intensity: 0.9; castShadow: true" position="2 4 2"></a-entity>

    <a-assets>
      <img id="earth-texture" src="https://upload.wikimedia.org/wikipedia/commons/thumb/0/04/Solarsystemscope_texture_8k_earth_daymap.jpg/1024px-Solarsystemscope_texture_8k_earth_daymap.jpg" crossorigin="anonymous">
    </a-assets>

    <a-nft type="nft" url="./earth" smooth="true" smoothCount="50" smoothTolerance="0.08" smoothThreshold="15" id="marker-earth">
      <a-entity position="0 0 0" super-smooth>
        <a-sphere position="100 170 -330" radius="150" segments-width="64" segments-height="64" material="src: #earth-texture; roughness: 1; metalness: 0">
          <a-animation attribute="rotation" from="0 0 0" to="0 360 0" dur="20000" repeat="indefinite" easing="linear"></a-animation>
        </a-sphere>
      </a-entity>
    </a-nft>

    <a-nft type="nft" url="./rocket" smooth="true" smoothCount="50" smoothTolerance="0.08" smoothThreshold="15" id="marker-rocket">
      <a-entity position="0 0 0" super-smooth>
        <a-entity gltf-model="./rocket.glb" position="100 -240 130" scale="40 40 40" rotation="270 0 0"></a-entity>
      </a-entity>
    </a-nft>

    <a-nft type="nft" url="./moon" smooth="true" smoothCount="50" smoothTolerance="0.08" smoothThreshold="15" id="marker-moon">
      <a-entity position="0 0 0" super-smooth>
        <a-entity gltf-model="./moon.glb" position="50 -100 -300" scale="40 40 40" rotation="0 0 0">
          <a-animation attribute="rotation" from="0 0 0" to="0 360 0" dur="30000" repeat="indefinite" easing="linear"></a-animation>
        </a-entity>
      </a-entity>
    </a-nft>

    <a-entity camera></a-entity>
  </a-scene>

  <script>
    const storyData = {
      chapters: [
        {
          title: "CHAPTER I: THE BLIGHT",
          story: `The year is <span class="neon">2157</span>. A mysterious pathogen known as "The Blight" has consumed <span class="neon">78% of Earth's surface</span>. Crops wither, oceans turn toxic, and the sky burns crimson. In just 3 years, <span class="neon">7.2 billion souls</span> have been lost. The remaining survivors huddle in sealed domes, waiting for salvation.`,
          target: "EARTH"
        },
        {
          title: "CHAPTER II: THE EXODUS",
          story: `Project <span class="neon">EXODUS</span> initiates. The last <span class="neon">12,000 survivors</span> board the massive Ark vessels - humanity's final hope. As fusion engines roar to life, the ships ascend through the poisoned atmosphere. Below, Earth grows smaller - a dying ember in the void. There is no looking back.`,
          target: "ROCKET"
        },
        {
          title: "CHAPTER III: NEW DAWN",
          story: `After 72 hours of travel, <span class="neon">Luna Colony Alpha</span> emerges on the horizon. The crystalline domes shimmer with artificial atmosphere, a beacon of hope against the darkness of space. As the Ark vessels dock, a new chapter begins. Humanity has survived - and among the stars, we shall rebuild.`,
          target: "MOON"
        }
      ]
    };

    let progress = [false, false, false];

    const loader = document.getElementById('loader');
    const scanTarget = document.getElementById('scan-target');
    const chapterPanel = document.getElementById('chapter-panel');
    const panelTitle = document.getElementById('panel-title');
    const panelStory = document.getElementById('panel-story');
    const victory = document.getElementById('victory');
    const dots = [document.getElementById('dot1'), document.getElementById('dot2'), document.getElementById('dot3')];

    document.getElementById('scene').addEventListener('loaded', () => {
      setTimeout(() => loader.classList.add('hidden'), 1500);
    });

    const markers = [
      document.getElementById('marker-earth'),
      document.getElementById('marker-rocket'),
      document.getElementById('marker-moon')
    ];

    markers.forEach((marker, i) => {
      if (marker) {
        marker.addEventListener('markerFound', () => onMarkerFound(i));
        marker.addEventListener('markerLost', () => chapterPanel.classList.remove('show'));
      }
    });

    function onMarkerFound(i) {
      const step = progress.filter(x => x).length;
      panelTitle.textContent = storyData.chapters[i].title;
      panelStory.innerHTML = storyData.chapters[i].story;
      chapterPanel.classList.add('show');

      if (i === step) {
        progress[i] = true;
        updateDots();
        if (progress.every(x => x)) {
          setTimeout(() => victory.classList.add('show'), 1500);
        }
      }
    }

    function updateDots() {
      const step = progress.filter(x => x).length;
      progress.forEach((done, i) => {
        dots[i].classList.toggle('active', done);
        dots[i].classList.toggle('current', i === step && step < 3);
      });
      if (step < 3) scanTarget.textContent = storyData.chapters[step].target;
      else scanTarget.textContent = 'COMPLETE';
    }

    function resetStory() {
      progress = [false, false, false];
      victory.classList.remove('show');
      dots.forEach((d, i) => { d.classList.remove('active'); d.classList.toggle('current', i === 0); });
      scanTarget.textContent = 'EARTH';
    }
  </script>
</body>
</html>
