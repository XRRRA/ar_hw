<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>EXODUS 2157 - AR Experience</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />

  <script src="https://aframe.io/releases/1.6.0/aframe.min.js"></script>
  <script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js/aframe/build/aframe-ar-nft.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Rajdhani:wght@300;500;700&display=swap" rel="stylesheet">

  <style>
    :root {
      --neon-cyan: #00f5ff;
      --neon-magenta: #ff00ff;
      --neon-purple: #b026ff;
      --neon-green: #00ff88;
      --neon-orange: #ff6600;
      --neon-red: #ff3344;
      --mars-orange: #ff6b35;
      --mars-red: #d4451a;
      --dark-bg: #0a0a12;
    }

    * { box-sizing: border-box; }
    body {
      margin: 0;
      overflow: hidden;
      font-family: 'Rajdhani', sans-serif;
      background: var(--dark-bg);
    }

    .loader {
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: var(--dark-bg);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 9999;
      transition: opacity 0.5s, visibility 0.5s;
    }
    .loader.hidden { opacity: 0; visibility: hidden; }
    .loader-title {
      font-family: 'Orbitron', sans-serif;
      font-size: 24px;
      font-weight: 900;
      color: var(--neon-cyan);
      text-shadow: 0 0 20px var(--neon-cyan);
      letter-spacing: 6px;
    }
    .loader-bar {
      width: 150px;
      height: 2px;
      background: #222;
      margin-top: 20px;
      position: relative;
      overflow: hidden;
    }
    .loader-bar::after {
      content: '';
      position: absolute;
      left: -50%;
      width: 50%;
      height: 100%;
      background: linear-gradient(90deg, transparent, var(--neon-cyan), transparent);
      animation: loadingBar 1.5s infinite;
    }
    @keyframes loadingBar { 0% { left: -50%; } 100% { left: 100%; } }

    .top-bar {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      background: linear-gradient(180deg, rgba(0,0,0,0.9) 0%, rgba(0,0,0,0.7) 70%, transparent 100%);
      padding: 12px 15px 20px 15px;
      z-index: 100;
      pointer-events: none;
    }

    .top-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
    }

    .logo {
      font-family: 'Orbitron', sans-serif;
      font-weight: 900;
      font-size: 16px;
      color: var(--neon-cyan);
      text-shadow: 0 0 10px var(--neon-cyan);
      letter-spacing: 3px;
    }
    .logo span { color: var(--neon-magenta); text-shadow: 0 0 10px var(--neon-magenta); }

    .status {
      font-size: 9px;
      color: #555;
      letter-spacing: 1px;
      text-align: right;
    }
    .status .online { color: var(--neon-green); }

    .progress-row {
      display: flex;
      gap: 6px;
      align-items: center;
    }
    .chapter-dot {
      flex: 1;
      display: flex;
      align-items: center;
      gap: 6px;
      padding: 6px 8px;
      background: rgba(0,0,0,0.5);
      border: 1px solid #222;
      border-radius: 6px;
      transition: all 0.3s;
    }
    .chapter-dot.active {
      border-color: var(--neon-cyan);
      box-shadow: 0 0 10px rgba(0,245,255,0.3);
    }
    .chapter-dot.active-mars {
      border-color: var(--mars-orange);
      box-shadow: 0 0 10px rgba(255,107,53,0.3);
    }
    .chapter-dot.current {
      border-color: var(--neon-orange);
      animation: pulse 1.5s infinite;
    }
    @keyframes pulse { 0%, 100% { box-shadow: 0 0 5px var(--neon-orange); } 50% { box-shadow: 0 0 12px var(--neon-orange); } }
    .dot-icon { font-size: 14px; }
    .dot-text {
      font-size: 8px;
      color: #555;
      letter-spacing: 1px;
      text-transform: uppercase;
    }
    .chapter-dot.active .dot-text, .chapter-dot.current .dot-text { color: #aaa; }
    .dot-or {
      font-size: 8px;
      color: #444;
      padding: 0 2px;
    }

    .bottom-bar {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      height: 35px;
      background: linear-gradient(0deg, rgba(0,0,0,0.8) 0%, transparent 100%);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 100;
      pointer-events: none;
    }
    .scan-hint {
      font-size: 10px;
      color: #666;
      letter-spacing: 2px;
    }
    .scan-hint .target {
      color: var(--neon-orange);
      font-weight: 700;
    }

    .corner {
      position: fixed;
      width: 20px;
      height: 20px;
      border: 1px solid rgba(0,245,255,0.4);
      z-index: 50;
    }
    .corner-tl { top: 8px; left: 8px; border-right: none; border-bottom: none; }
    .corner-tr { top: 8px; right: 8px; border-left: none; border-bottom: none; }
    .corner-bl { bottom: 8px; left: 8px; border-right: none; border-top: none; }
    .corner-br { bottom: 8px; right: 8px; border-left: none; border-top: none; }

    .chapter-panel {
      position: fixed;
      bottom: 50px;
      left: 12px;
      right: 12px;
      background: linear-gradient(135deg, rgba(0,0,0,0.92) 0%, rgba(20,0,40,0.92) 100%);
      border: 1px solid var(--neon-purple);
      border-radius: 8px;
      padding: 14px 16px;
      z-index: 150;
      opacity: 0;
      transform: translateY(10px);
      transition: all 0.3s;
      pointer-events: none;
    }
    .chapter-panel.show { opacity: 1; transform: translateY(0); }
    .chapter-panel.mars-theme {
      background: linear-gradient(135deg, rgba(0,0,0,0.92) 0%, rgba(40,10,0,0.92) 100%);
      border-color: var(--mars-orange);
    }
    .chapter-panel-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 8px;
    }
    .chapter-panel-title {
      font-family: 'Orbitron', sans-serif;
      font-size: 12px;
      color: var(--neon-purple);
      text-shadow: 0 0 8px var(--neon-purple);
      letter-spacing: 2px;
    }
    .chapter-panel.mars-theme .chapter-panel-title {
      color: var(--mars-orange);
      text-shadow: 0 0 8px var(--mars-orange);
    }
    .chapter-panel-status {
      font-size: 9px;
      color: var(--neon-green);
      letter-spacing: 1px;
    }
    .chapter-panel-story {
      font-size: 13px;
      color: #bbb;
      line-height: 1.5;
    }
    .chapter-panel-story .neon {
      color: var(--neon-cyan);
      font-weight: 600;
    }
    .chapter-panel.mars-theme .chapter-panel-story .neon {
      color: var(--mars-orange);
    }

    .victory {
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: radial-gradient(ellipse at center, rgba(0,20,40,0.95) 0%, rgba(0,0,0,0.98) 100%);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 300;
      opacity: 0;
      visibility: hidden;
      transition: all 0.5s;
    }
    .victory.show { opacity: 1; visibility: visible; }
    .victory.mars-ending {
      background: radial-gradient(ellipse at center, rgba(40,15,0,0.95) 0%, rgba(0,0,0,0.98) 100%);
    }
    .victory-badge {
      width: 70px;
      height: 70px;
      border: 2px solid var(--neon-green);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 35px;
      margin-bottom: 15px;
      box-shadow: 0 0 25px var(--neon-green);
    }
    .victory.mars-ending .victory-badge {
      border-color: var(--mars-orange);
      box-shadow: 0 0 25px var(--mars-orange);
    }
    .victory-title {
      font-family: 'Orbitron', sans-serif;
      font-size: 18px;
      font-weight: 900;
      color: var(--neon-green);
      text-shadow: 0 0 15px var(--neon-green);
      letter-spacing: 4px;
      margin-bottom: 8px;
    }
    .victory.mars-ending .victory-title {
      color: var(--mars-orange);
      text-shadow: 0 0 15px var(--mars-orange);
    }
    .victory-subtitle {
      font-size: 11px;
      color: #666;
      letter-spacing: 2px;
      margin-bottom: 20px;
    }
    .victory-story {
      max-width: 280px;
      text-align: center;
      margin-bottom: 25px;
    }
    .victory-story p {
      font-size: 12px;
      color: #888;
      line-height: 1.5;
      margin: 8px 0;
    }
    .victory-story .em { color: var(--neon-cyan); font-weight: 600; }
    .victory.mars-ending .victory-story .em { color: var(--mars-orange); }
    .victory-btn {
      font-family: 'Orbitron', sans-serif;
      padding: 12px 30px;
      font-size: 10px;
      letter-spacing: 2px;
      background: transparent;
      color: var(--neon-cyan);
      border: 1px solid var(--neon-cyan);
      cursor: pointer;
      transition: all 0.3s;
      pointer-events: auto;
    }
    .victory.mars-ending .victory-btn {
      color: var(--mars-orange);
      border-color: var(--mars-orange);
    }
    .victory-btn:active {
      background: var(--neon-cyan);
      color: #000;
    }
    .victory.mars-ending .victory-btn:active {
      background: var(--mars-orange);
    }
  </style>

  <script>
    AFRAME.registerComponent('super-smooth', {
      schema: {
        position: {type: 'vec3'},
        rotation: {type: 'vec3'}
      },
      init: function() {
        this.smoothPos = new THREE.Vector3();
        this.smoothRot = new THREE.Euler();
        this.initialized = false;
      },
      tick: function() {
        const obj = this.el.object3D;
        if (!this.initialized) {
          this.smoothPos.copy(obj.position);
          this.smoothRot.copy(obj.rotation);
          this.initialized = true;
          return;
        }
        const factor = 0.1;
        this.smoothPos.lerp(obj.position, factor);
        this.smoothRot.x += (obj.rotation.x - this.smoothRot.x) * factor;
        this.smoothRot.y += (obj.rotation.y - this.smoothRot.y) * factor;
        this.smoothRot.z += (obj.rotation.z - this.smoothRot.z) * factor;
        obj.position.copy(this.smoothPos);
        obj.rotation.copy(this.smoothRot);
      }
    });
  </script>
</head>
<body>
  <div class="corner corner-tl"></div>
  <div class="corner corner-tr"></div>
  <div class="corner corner-bl"></div>
  <div class="corner corner-br"></div>

  <div class="loader" id="loader">
    <div class="loader-title">EXODUS 2157</div>
    <div class="loader-bar"></div>
  </div>

  <div class="top-bar">
    <div class="top-row">
      <div class="logo">EXODUS<span>2157</span></div>
      <div class="status">SYSTEM <span class="online">ONLINE</span><br>AR TRACKING</div>
    </div>
    <div class="progress-row">
      <div class="chapter-dot current" id="dot-earth">
        <span class="dot-icon">üåç</span>
        <span class="dot-text">Earth</span>
      </div>
      <div class="chapter-dot" id="dot-rocket">
        <span class="dot-icon">üöÄ</span>
        <span class="dot-text">Exodus</span>
      </div>
      <div class="chapter-dot" id="dot-moon">
        <span class="dot-icon">üåô</span>
        <span class="dot-text">Moon</span>
      </div>
      <span class="dot-or">OR</span>
      <div class="chapter-dot" id="dot-mars">
        <span class="dot-icon">üî¥</span>
        <span class="dot-text">Mars</span>
      </div>
    </div>
  </div>

  <div class="bottom-bar">
    <div class="scan-hint">SCAN <span class="target" id="scan-target">EARTH</span></div>
  </div>

  <div class="chapter-panel" id="chapter-panel">
    <div class="chapter-panel-header">
      <div class="chapter-panel-title" id="panel-title">CHAPTER I: THE BLIGHT</div>
      <div class="chapter-panel-status">UNLOCKED</div>
    </div>
    <div class="chapter-panel-story" id="panel-story">Story content...</div>
  </div>

  <div class="victory" id="victory">
    <div class="victory-badge" id="victory-badge">üõ°Ô∏è</div>
    <div class="victory-title" id="victory-title">COMPLETE</div>
    <div class="victory-subtitle" id="victory-subtitle">HUMANITY PRESERVED</div>
    <div class="victory-story" id="victory-story">
      <p>The <span class="em">Exodus Initiative</span> succeeded.</p>
      <p>12,000 survivors call <span class="em">Luna Colony</span> home.</p>
    </div>
    <button class="victory-btn" onclick="resetStory()">RESTART</button>
  </div>

  <a-scene
    embedded
    renderer="colorManagement: true; physicallyCorrectLights: true; logarithmicDepthBuffer: true"
    vr-mode-ui="enabled: false"
    arjs="sourceType: webcam; trackingMethod: best; debugUIEnabled: false;"
    id="scene">

    <a-entity light="type: ambient; intensity: 0.7"></a-entity>
    <a-entity light="type: directional; intensity: 0.9; castShadow: true" position="2 4 2"></a-entity>

    <a-assets>
      <img id="earth-texture" src="https://upload.wikimedia.org/wikipedia/commons/thumb/0/04/Solarsystemscope_texture_8k_earth_daymap.jpg/1024px-Solarsystemscope_texture_8k_earth_daymap.jpg" crossorigin="anonymous">
      <img id="mars-texture" src="https://www.solarsystemscope.com/textures/download/2k_mars.jpg" crossorigin="anonymous">
    </a-assets>

    <a-nft type="nft" url="./earth" smooth="true" smoothCount="50" smoothTolerance="0.08" smoothThreshold="15" id="marker-earth">
      <a-entity position="0 0 0" super-smooth>
        <a-sphere position="100 170 -330" radius="150" segments-width="64" segments-height="64" material="src: #earth-texture; roughness: 1; metalness: 0">
          <a-animation attribute="rotation" from="0 0 0" to="0 360 0" dur="20000" repeat="indefinite" easing="linear"></a-animation>
        </a-sphere>
      </a-entity>
    </a-nft>

    <a-nft type="nft" url="./rocket" smooth="true" smoothCount="50" smoothTolerance="0.08" smoothThreshold="15" id="marker-rocket">
      <a-entity position="0 0 0" super-smooth>
        <a-entity gltf-model="./rocket.glb" position="100 -240 130" scale="40 40 40" rotation="270 0 0"></a-entity>
      </a-entity>
    </a-nft>

    <a-nft type="nft" url="./moon" smooth="true" smoothCount="50" smoothTolerance="0.08" smoothThreshold="15" id="marker-moon">
      <a-entity position="0 0 0" super-smooth>
        <a-entity gltf-model="./moon.glb" position="50 -100 -300" scale="40 40 40" rotation="0 0 0">
          <a-animation attribute="rotation" from="0 0 0" to="0 360 0" dur="30000" repeat="indefinite" easing="linear"></a-animation>
        </a-entity>
      </a-entity>
    </a-nft>

    <a-nft type="nft" url="./mars" smooth="true" smoothCount="50" smoothTolerance="0.08" smoothThreshold="15" id="marker-mars">
      <a-entity position="0 0 0" super-smooth>
        <a-sphere position="100 170 -330" radius="140" segments-width="64" segments-height="64" material="src: #mars-texture; roughness: 1; metalness: 0">
          <a-animation attribute="rotation" from="0 0 0" to="0 360 0" dur="25000" repeat="indefinite" easing="linear"></a-animation>
        </a-sphere>
      </a-entity>
    </a-nft>

    <a-entity camera></a-entity>
  </a-scene>

  <script>
    const storyData = {
      earth: {
        title: "CHAPTER I: THE BLIGHT",
        story: `The year is <span class="neon">2157</span>. A mysterious pathogen known as "The Blight" has consumed <span class="neon">78% of Earth's surface</span>. Crops wither, oceans turn toxic, and the sky burns crimson. In just 3 years, <span class="neon">7.2 billion souls</span> have been lost. The remaining survivors huddle in sealed domes, waiting for salvation.`
      },
      rocket: {
        title: "CHAPTER II: THE EXODUS",
        story: `Project <span class="neon">EXODUS</span> initiates. The last <span class="neon">12,000 survivors</span> board the massive Ark vessels - humanity's final hope. As fusion engines roar to life, the ships ascend through the poisoned atmosphere. Below, Earth grows smaller - a dying ember in the void. Choose your destination: <span class="neon">MOON</span> or <span class="neon">MARS</span>.`
      },
      moon: {
        title: "CHAPTER III: LUNA COLONY",
        story: `After 72 hours of travel, <span class="neon">Luna Colony Alpha</span> emerges on the horizon. The crystalline domes shimmer with artificial atmosphere, a beacon of hope against the darkness of space. As the Ark vessels dock, a new chapter begins. Humanity has survived - and among the stars, we shall rebuild.`
      },
      mars: {
        title: "CHAPTER III: THE RED FRONTIER",
        story: `After <span class="neon">7 months</span> of interplanetary travel, the rust-colored sphere of <span class="neon">Mars</span> fills the viewport. The Olympus Mons base awaits - humanity's boldest outpost. Unlike the Moon, Mars offers atmosphere, water ice, and a future. This is not just survival - this is <span class="neon">a new beginning</span>.`
      }
    };

    const endings = {
      moon: {
        badge: "üåô",
        title: "LUNA COMPLETE",
        subtitle: "SANCTUARY ACHIEVED",
        story: `<p>The <span class="em">Exodus Initiative</span> succeeded.</p><p><span class="em">12,000 survivors</span> call Luna Colony home.</p><p>Close to Earth, we watch and wait for her healing.</p>`
      },
      mars: {
        badge: "üî¥",
        title: "MARS COMPLETE",
        subtitle: "NEW WORLD CONQUERED",
        story: `<p>The <span class="em">Red Frontier</span> is ours.</p><p><span class="em">12,000 pioneers</span> begin terraforming Mars.</p><p>A new planet. A new species. <span class="em">Homo Martis</span> is born.</p>`
      }
    };

    let state = { earth: false, rocket: false, destination: null };

    const loader = document.getElementById('loader');
    const scanTarget = document.getElementById('scan-target');
    const chapterPanel = document.getElementById('chapter-panel');
    const panelTitle = document.getElementById('panel-title');
    const panelStory = document.getElementById('panel-story');
    const victory = document.getElementById('victory');

    const dots = {
      earth: document.getElementById('dot-earth'),
      rocket: document.getElementById('dot-rocket'),
      moon: document.getElementById('dot-moon'),
      mars: document.getElementById('dot-mars')
    };

    document.getElementById('scene').addEventListener('loaded', () => {
      setTimeout(() => loader.classList.add('hidden'), 1500);
    });

    const markerIds = ['marker-earth', 'marker-rocket', 'marker-moon', 'marker-mars'];
    markerIds.forEach(id => {
      const marker = document.getElementById(id);
      if (marker) {
        const type = id.replace('marker-', '');
        marker.addEventListener('markerFound', () => onMarkerFound(type));
        marker.addEventListener('markerLost', () => chapterPanel.classList.remove('show'));
      }
    });

    function onMarkerFound(type) {
      const isMars = type === 'mars';
      chapterPanel.classList.toggle('mars-theme', isMars);
      panelTitle.textContent = storyData[type].title;
      panelStory.innerHTML = storyData[type].story;
      chapterPanel.classList.add('show');

      if (type === 'earth' && !state.earth) {
        state.earth = true;
        updateUI();
      } else if (type === 'rocket' && state.earth && !state.rocket) {
        state.rocket = true;
        updateUI();
      } else if ((type === 'moon' || type === 'mars') && state.rocket && !state.destination) {
        state.destination = type;
        updateUI();
        setTimeout(() => showVictory(type), 1500);
      }
    }

    function updateUI() {
      dots.earth.classList.toggle('active', state.earth);
      dots.earth.classList.toggle('current', !state.earth);

      dots.rocket.classList.toggle('active', state.rocket);
      dots.rocket.classList.toggle('current', state.earth && !state.rocket);

      const choosingDest = state.rocket && !state.destination;
      dots.moon.classList.toggle('active', state.destination === 'moon');
      dots.moon.classList.toggle('current', choosingDest);
      dots.mars.classList.toggle('active-mars', state.destination === 'mars');
      dots.mars.classList.toggle('current', choosingDest);

      if (!state.earth) scanTarget.textContent = 'EARTH';
      else if (!state.rocket) scanTarget.textContent = 'ROCKET';
      else if (!state.destination) scanTarget.textContent = 'MOON or MARS';
      else scanTarget.textContent = 'COMPLETE';
    }

    function showVictory(type) {
      const end = endings[type];
      victory.classList.toggle('mars-ending', type === 'mars');
      document.getElementById('victory-badge').textContent = end.badge;
      document.getElementById('victory-title').textContent = end.title;
      document.getElementById('victory-subtitle').textContent = end.subtitle;
      document.getElementById('victory-story').innerHTML = end.story;
      victory.classList.add('show');
    }

    function resetStory() {
      state = { earth: false, rocket: false, destination: null };
      victory.classList.remove('show', 'mars-ending');
      chapterPanel.classList.remove('mars-theme');
      Object.values(dots).forEach(d => d.classList.remove('active', 'active-mars', 'current'));
      dots.earth.classList.add('current');
      scanTarget.textContent = 'EARTH';
    }
  </script>
</body>
</html>
